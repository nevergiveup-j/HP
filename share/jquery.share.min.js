/**
 * @Description: jQuery 分享到 插件
 * @Author: wangjun
 * @Update: 2014-07-18 16:00
 * @version: 1.0
 * @Github URL: https://github.com/nevergiveup-j/HP/tree/master/share
 */

(function(c){typeof define==="function"&&define.amd?define(["jquery"],c):c(jQuery)})(function(c){function i(a,b){this.$elem=a;if(this.$elem.length){this.options=c.extend({},g,b);this.init()}}var g={social:["weibo","tqq","qzone","renren"],theme:"icon",shareConfig:{title:document.title,url:window.location.href,pic:"",summary:"",desc:"",searchPic:true,source:{appkey:{weibo:"",tqq:""},ralateUid:{weibo:"",tqq:""},siteName:""}},buttons:{weibo:{text:"\u65b0\u6d6a\u5fae\u535a",className:"btn-share-weibo",
url:"http://service.weibo.com/share/share.php?url={url}&title={title}&pic={pic}&appkey={appkey}&ralateUid={ralateUid}&searchPic={searchPic}"},tqq:{text:"\u817e\u8baf\u5fae\u535a",className:"btn-share-tqq",url:"http://v.t.qq.com/share/share.php?url={url}&title={title}&pic={pic}&appkey={appkey}"},qzone:{text:"QQ\u7a7a\u95f4",className:"btn-share-qzone",url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={url}&title={title}&pics={pic}&summary={summary}&site={site}"},renren:{text:"\u4eba\u4eba\u7f51",
className:"btn-share-renren",url:"http://widget.renren.com/dialog/share?link={url}&title={title}&pic={pic}"},qq:{text:"QQ",className:"btn-share-qq",url:"http://connect.qq.com/widget/shareqq/index.html?url={url}&title={title}&pics={pic}&summary={summary}&desc={desc}&site={site}"},weixin:{text:"\u5fae\u4fe1",className:"btn-share-weixin",url:""}}};i.prototype={version:"1.0",init:function(){this.render();this.$list=this.$elem.find(".btn-share");this.bind()},render:function(){var a=this.options.social,
b=null,f=['<div class="hp-shareTo-inner">'];for(var e in a){e=a[e];b=this.options.buttons[e];typeof b!=="undefined"&&f.push('<a href="javascript:" data-type="'+e+'" class="btn-share '+b.className+'" title="'+b.text+'">'+b.text+"</a>")}f.push("</div>");this.$elem.append(f.join(""))},bind:function(){var a=null,b=this.options.shareConfig;b.buttons=this.options.buttons;this.$list.bind("click",function(){a=c(this).data("type");new h(a,b)})}};var h=function(a,b){function f(j,k){var l="";return l=a==="tqq"?
k:j}var e=g.shareConfig;e.buttons=g.buttons;var d=c.extend(true,{},e,b||{}),m=encodeURIComponent(d.title);b=encodeURIComponent(d.url);var n=encodeURIComponent(d.pic),o=encodeURIComponent(d.summary),p=encodeURIComponent(d.desc),q=encodeURIComponent(d.source.site),r=f(d.source.appkey.weibo,d.source.appkey.tqq);f(d.source.ralateUid.weibo,d.source.ralateUid.tqq);if(typeof d.buttons[a]!=="undefined"){var s=(window.screen.availHeight-30-500)/2,t=(window.screen.availWidth-10-600)/2;e="";if(a!=="qq")e="scrollbars=no,width=600,height=500,left="+
t+",top="+s+",status=no,resizable=yes";d=d.buttons[a].url.replace("{url}",b).replace("{title}",m).replace("{pic}",n).replace("{appkey}",r).replace("{ralateUid}",d.ralateUid).replace("{summary}",o).replace("{site}",q).replace("{desc}",p).replace("{searchPic}",d.searchPic);if(a==="weixin"){u.init({title:"\u6253\u5f00\u5fae\u4fe1\u201c\u626b\u4e00\u626b\u201d<br />\u6253\u5f00\u7f51\u9875\u540e\u70b9\u51fb\u5c4f\u5e55\u53f3\u4e0a\u89d2\u5206\u4eab\u6309\u94ae",content:'<p style="width:162px;height:162px;margin:0 auto;text-align:center;padding:20px 0 45px;" id="J_qrcodeWeixin"></p>'});
new QRCode("J_qrcodeWeixin",{text:b,width:162,height:162})}else window.open(d,a,e)}},u={init:function(a){this.options=a;this.T_RESIZE=null;this.$win=c(window);this.$body=c("body");this.render();this.bind()},render:function(){this.$body.append(['<div class="hp-share-mask" id="J_hp_share_mask"></div><div id="J_hp_popShare" class="hp-pop-share"><div class="hd"><h3>',this.options.title,'</h3><a href="javascript:" class="btn-close">\u00d7</a></div><div class="bd">',this.options.content,"</div></div>"].join(""));
this.$mask=c("#J_hp_share_mask");this.$popLayer=c("#J_hp_popShare");this.$btnClose=this.$popLayer.find(".btn-close");this.setResizeSize()},bind:function(){var a=this;c(document).bind("keydown","esc",function(){a.hide()});a.$mask.bind("click",function(){a.hide()});a.$btnClose.bind("click",function(){a.hide()});a.$win.bind("resize",function(){a.T_RESIZE=setTimeout(function(){a.setResizeSize()},200)})},hide:function(){clearTimeout(this.T_RESIZE);c(document).unbind();this.$mask.unbind().fadeOut("fast",
function(){c(this).remove()});this.$popLayer.addClass("voice-pop-in-share").fadeOut("fast",function(){c(this).remove()})},setResizeSize:function(){var a=Math.max(document.body.clientHeight,document.body.offsetHeight,document.documentElement.clientHeight),b=this.getPosCenter();this.$mask.css({display:"block",width:"100%",height:a});this.$popLayer.css({position:"absolute",top:b.top,left:b.left}).show()},getPosCenter:function(){var a=this.$win.width(),b=this.$win.height(),f=this.$win.scrollTop(),e=this.$win.scrollLeft(),
d=this.$popLayer.width();return{top:f+(b-300)/2,left:e+(a-d)/2,viewWidth:a}}};c.extend({shareAPI:function(a,b){new h(a,b)}});c.shareAPI.version="1.0";c.fn.share=function(a){return this.each(function(){var b=c(this);new i(b,a)})};return h});
