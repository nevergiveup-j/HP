/* @Github URL: https://github.com/nevergiveup-j/HP/tree/master/share */
(function(c){typeof define==="function"&&define.amd?define(["jquery"],c):c(jQuery)})(function(c){function k(b,a){this.$elem=b;if(this.$elem.length){this.options=c.extend(true,{},h,a||{});this.init()}}var h={social:["weibo","tqq","qzone","renren"],theme:"icon",shareConfig:{title:document.title,url:window.location.href,pic:"",summary:"",desc:"",searchPic:true,source:{appkey:{weibo:"",tqq:""},ralateUid:{weibo:"",tqq:""},siteName:""}},buttons:{weibo:{text:"\u65b0\u6d6a\u5fae\u535a",className:"weibo",
url:"http://service.weibo.com/share/share.php?url={url}&title={title}&pic={pic}&appkey={appkey}&ralateUid={ralateUid}&searchPic={searchPic}"},tqq:{text:"\u817e\u8baf\u5fae\u535a",className:"tqq",url:"http://v.t.qq.com/share/share.php?url={url}&title={title}&pic={pic}&appkey={appkey}"},qzone:{text:"QQ\u7a7a\u95f4",className:"qzone",url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={url}&title={title}&pics={pic}&summary={summary}&site={site}"},renren:{text:"\u4eba\u4eba\u7f51",className:"renren",
url:"http://widget.renren.com/dialog/share?link={url}&title={title}&pic={pic}"},qq:{text:"QQ",className:"qq",url:"http://connect.qq.com/widget/shareqq/index.html?url={url}&title={title}&pics={pic}&summary={summary}&desc={desc}&site={site}"},weixin:{text:"\u5fae\u4fe1",className:"weixin",url:""},douban:{text:"\u8c46\u74e3",className:"douban",url:"http://www.douban.com/share/service?href={url}&name={title}&text={summary}"},twitter:{text:"twitter",className:"twitter",url:"https://twitter.com/share?url={url}&text={title}"},
facebook:{text:"facebook",className:"facebook",url:"http://www.facebook.com/sharer.php?u={url}&t={title}"}}};k.prototype={version:"1.0",init:function(){this.render();this.$list=this.$elem.find(".btn-share");this.bind()},render:function(){var b=this.options.social,a=null,e=['<div class="hp-shareTo-inner">'];for(var d in b){d=b[d];a=this.options.buttons[d];typeof a!=="undefined"&&e.push('<a href="javascript:" data-type="'+d+'" class="btn-share btn-share-'+a.className+'" title="'+a.text+'">'+a.text+
"</a>")}e.push("</div>");this.$elem.append(e.join(""))},bind:function(){var b=null,a=this.options.shareConfig;a.buttons=this.options.buttons;this.$list.bind("click",function(){b=c(this).data("type");new i(b,a)})}};var i=function(b,a){function e(l,m){var n="";return n=b==="tqq"?m:l}var d=h.shareConfig;d.buttons=h.buttons;a=c.extend(true,{},d,a||{});d=encodeURIComponent(a.title);var j=encodeURIComponent(a.url),f=a.pic,o=encodeURIComponent(a.summary),p=encodeURIComponent(a.desc),q=encodeURIComponent(a.source.site),
r=e(a.source.appkey.weibo,a.source.appkey.tqq);e(a.source.ralateUid.weibo,a.source.ralateUid.tqq);if(typeof a.buttons[b]!=="undefined"){var g=f.split("||");if(g.length>1&&b!=="weibo")f=g[0];f=encodeURIComponent(f);var s=(window.screen.availHeight-30-500)/2,t=(window.screen.availWidth-10-600)/2;g="";if(b!=="qq")g="scrollbars=no,width=600,height=500,left="+t+",top="+s+",status=no,resizable=yes";d=a.buttons[b].url.replace("{url}",j).replace("{title}",d).replace("{pic}",f).replace("{appkey}",r).replace("{ralateUid}",
a.ralateUid).replace("{summary}",o).replace("{site}",q).replace("{desc}",p).replace("{searchPic}",a.searchPic);if(b==="weixin"){u.init({title:"\u6253\u5f00\u5fae\u4fe1\u201c\u626b\u4e00\u626b\u201d<br />\u6253\u5f00\u7f51\u9875\u540e\u70b9\u51fb\u5c4f\u5e55\u53f3\u4e0a\u89d2\u5206\u4eab\u6309\u94ae",content:'<p style="width:162px;height:162px;margin:0 auto;text-align:center;padding:20px 0 45px;" id="J_qrcodeWeixin"></p>'});new QRCode("J_qrcodeWeixin",{text:a.url,width:162,height:162})}else window.open(d,
b,g)}},u={init:function(b){this.options=b;this.T_RESIZE=null;this.$win=c(window);this.$body=c("body");this.render();this.bind()},render:function(){this.$body.append(['<div class="hp-share-mask" id="J_hp_share_mask"></div><div id="J_hp_popShare" class="hp-pop-share"><div class="hd"><h3>',this.options.title,'</h3><a href="javascript:" class="btn-close">\u00d7</a></div><div class="bd">',this.options.content,"</div></div>"].join(""));this.$mask=c("#J_hp_share_mask");this.$popLayer=c("#J_hp_popShare");
this.$btnClose=this.$popLayer.find(".btn-close");this.setResizeSize()},bind:function(){var b=this;c(document).bind("keydown","esc",function(){b.hide()});b.$mask.bind("click",function(){b.hide()});b.$btnClose.bind("click",function(){b.hide()});b.$win.bind("resize",function(){b.T_RESIZE=setTimeout(function(){b.setResizeSize()},200)})},hide:function(){clearTimeout(this.T_RESIZE);c(document).unbind();this.$mask.unbind().fadeOut("fast",function(){c(this).remove()});this.$popLayer.addClass("voice-pop-in-share").fadeOut("fast",
function(){c(this).remove()})},setResizeSize:function(){var b=Math.max(document.body.clientHeight,document.body.offsetHeight,document.documentElement.clientHeight),a=this.getPosCenter();this.$mask.css({display:"block",width:"100%",height:b});this.$popLayer.css({position:"absolute",top:a.top,left:a.left}).show()},getPosCenter:function(){var b=this.$win.width(),a=this.$win.height(),e=this.$win.scrollTop(),d=this.$win.scrollLeft(),j=this.$popLayer.width();return{top:e+(a-300)/2,left:d+(b-j)/2,viewWidth:b}}};
c.extend({shareAPI:function(b,a){new i(b,a)}});c.shareAPI.version="1.0";c.fn.share=function(b){return this.each(function(){var a=c(this);new k(a,b)})};return i});
