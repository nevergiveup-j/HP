/* @Github URL: https://github.com/nevergiveup-j/HP/tree/master/share */
(function(d){typeof define==="function"&&define.amd?define(["jquery"],d):d(jQuery)})(function(d){function k(a,c){this.$elem=a;if(this.$elem.length){this.options=d.extend(true,{},h,c||{});this.init()}}var h={social:["weibo","tqq","qzone","renren"],theme:"icon",shareConfig:{title:document.title,url:window.location.href,pic:"",summary:"",desc:"",searchPic:true,source:{appkey:{weibo:"",tqq:""},ralateUid:{weibo:"",tqq:""},siteName:""}},buttons:{weibo:{text:"\u65b0\u6d6a\u5fae\u535a",className:"weibo",
url:"http://service.weibo.com/share/share.php?url={url}&title={title}&pic={pic}&appkey={appkey}&ralateUid={ralateUid}&searchPic={searchPic}"},tqq:{text:"\u817e\u8baf\u5fae\u535a",className:"tqq",url:"http://v.t.qq.com/share/share.php?url={url}&title={title}&pic={pic}&appkey={appkey}"},qzone:{text:"QQ\u7a7a\u95f4",className:"qzone",url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={url}&title={title}&pics={pic}&summary={summary}&site={site}"},renren:{text:"\u4eba\u4eba\u7f51",className:"renren",
url:"http://widget.renren.com/dialog/share?link={url}&title={title}&pic={pic}"},qq:{text:"QQ",className:"qq",url:"http://connect.qq.com/widget/shareqq/index.html?url={url}&title={title}&pics={pic}&summary={summary}&desc={desc}&site={site}"},weixin:{text:"\u5fae\u4fe1",className:"weixin",url:""},douban:{text:"\u8c46\u74e3",className:"douban",url:"http://www.douban.com/share/service?href={url}&name={title}&text={summary}"},twitter:{text:"twitter",className:"twitter",url:"https://twitter.com/share?url={url}&text={title}"},
facebook:{text:"facebook",className:"facebook",url:"http://www.facebook.com/sharer.php?u={url}&t={title}"}}};k.prototype={version:"1.0",init:function(){this.render();this.$list=this.$elem.find(".btn-share");this.bind()},render:function(){var a=this.options.social,c=null,e=['<div class="hp-shareTo-inner">'];for(var b in a){b=a[b];c=this.options.buttons[b];typeof c!=="undefined"&&e.push('<a href="javascript:" data-type="'+b+'" class="btn-share btn-share-'+c.className+'" title="'+c.text+'">'+c.text+
"</a>")}e.push("</div>");this.$elem.append(e.join(""))},bind:function(){var a=null,c=this.options.shareConfig;c.buttons=this.options.buttons;this.$list.bind("click",function(){a=d(this).data("type");new i(a,c)})}};var i=function(a,c){function e(l,m){var n="";return n=a==="tqq"?m:l}var b=h.shareConfig;b.buttons=h.buttons;b=d.extend(true,{},b,c||{});var j=encodeURIComponent(b.title);c=encodeURIComponent(b.url);var f=b.pic,o=encodeURIComponent(b.summary),p=encodeURIComponent(b.desc),q=encodeURIComponent(b.source.site),
r=e(b.source.appkey.weibo,b.source.appkey.tqq);e(b.source.ralateUid.weibo,b.source.ralateUid.tqq);if(typeof b.buttons[a]!=="undefined"){var g=f.split("||");if(g.length>1&&a!=="weibo")f=g[0];f=encodeURIComponent(f);var s=(window.screen.availHeight-30-500)/2,t=(window.screen.availWidth-10-600)/2;g="";if(a!=="qq")g="scrollbars=no,width=600,height=500,left="+t+",top="+s+",status=no,resizable=yes";b=b.buttons[a].url.replace("{url}",c).replace("{title}",j).replace("{pic}",f).replace("{appkey}",r).replace("{ralateUid}",
b.ralateUid).replace("{summary}",o).replace("{site}",q).replace("{desc}",p).replace("{searchPic}",b.searchPic);if(a==="weixin"){u.init({title:"\u6253\u5f00\u5fae\u4fe1\u201c\u626b\u4e00\u626b\u201d<br />\u6253\u5f00\u7f51\u9875\u540e\u70b9\u51fb\u5c4f\u5e55\u53f3\u4e0a\u89d2\u5206\u4eab\u6309\u94ae",content:'<p style="width:162px;height:162px;margin:0 auto;text-align:center;padding:20px 0 45px;" id="J_qrcodeWeixin"></p>'});new QRCode("J_qrcodeWeixin",{text:c,width:162,height:162})}else window.open(b,
a,g)}},u={init:function(a){this.options=a;this.T_RESIZE=null;this.$win=d(window);this.$body=d("body");this.render();this.bind()},render:function(){this.$body.append(['<div class="hp-share-mask" id="J_hp_share_mask"></div><div id="J_hp_popShare" class="hp-pop-share"><div class="hd"><h3>',this.options.title,'</h3><a href="javascript:" class="btn-close">\u00d7</a></div><div class="bd">',this.options.content,"</div></div>"].join(""));this.$mask=d("#J_hp_share_mask");this.$popLayer=d("#J_hp_popShare");
this.$btnClose=this.$popLayer.find(".btn-close");this.setResizeSize()},bind:function(){var a=this;d(document).bind("keydown","esc",function(){a.hide()});a.$mask.bind("click",function(){a.hide()});a.$btnClose.bind("click",function(){a.hide()});a.$win.bind("resize",function(){a.T_RESIZE=setTimeout(function(){a.setResizeSize()},200)})},hide:function(){clearTimeout(this.T_RESIZE);d(document).unbind();this.$mask.unbind().fadeOut("fast",function(){d(this).remove()});this.$popLayer.addClass("voice-pop-in-share").fadeOut("fast",
function(){d(this).remove()})},setResizeSize:function(){var a=Math.max(document.body.clientHeight,document.body.offsetHeight,document.documentElement.clientHeight),c=this.getPosCenter();this.$mask.css({display:"block",width:"100%",height:a});this.$popLayer.css({position:"absolute",top:c.top,left:c.left}).show()},getPosCenter:function(){var a=this.$win.width(),c=this.$win.height(),e=this.$win.scrollTop(),b=this.$win.scrollLeft(),j=this.$popLayer.width();return{top:e+(c-300)/2,left:b+(a-j)/2,viewWidth:a}}};
d.extend({shareAPI:function(a,c){new i(a,c)}});d.shareAPI.version="1.0";d.fn.share=function(a){return this.each(function(){var c=d(this);new k(c,a)})};return i});
