/* @Github URL: https://github.com/nevergiveup-j/HP/tree/master/popup */
(function(c){typeof define==="function"&&define.amd?define(["jquery"],c):c(jQuery)})(function(c){function f(a,b,d){if(c.isFunction(b)){d=b;b=null}this.$popup=a;this.options=c.extend(true,{},j,b||{});this.callback=d;this.ID_NUMBER=(e.data("popup")||0)+1;this.ID_NAME="J_popup_mask_"+this.ID_NUMBER;this.T_RESIZE=null;this.triggerCall(this.options.onOpenCallback);this.init()}var j={appendTo:"body",escClose:true,opacity:0.7,position:["auto","auto"],positionManner:"fixed",mask:true,maskClose:true,maskColor:"#000",
speed:250,zIndex:999,onOpenCallback:function(){},onCloseCallback:function(){}},g=c(document),e=c(window),h=c.browser.msie&&c.browser.version=="6.0";f.prototype={version:"1.0",init:function(){e.data("popup",this.ID_NUMBER);this.render();this.bind()},render:function(){var a=this,b="100%",d=parseInt(a.options.zIndex);if(h){b=Math.max(document.body.clientHeight,document.body.offsetHeight,document.documentElement.clientHeight);a.options.positionManner="absolute"}a.options.mask&&c('<div class="hp-popup-mask '+
a.ID_NAME+'"></div>').css({"background-color":a.options.maskColor,position:a.options.positionManner,top:0,right:0,bottom:0,left:0,width:"100%",height:b,opacity:0,cursor:"pointer","z-index":d+a.ID_NUMBER}).appendTo(a.options.appendTo).fadeTo(a.options.speed,a.options.opacity);a.$popup.data("id",a.ID_NUMBER).css({position:a.options.positionManner||"absolute","z-index":d+a.ID_NUMBER+1}).each(function(){c(this).appendTo(a.options.appendTo)});b=a.calcPosition();d=b.fixedVPos;if(h)d+=e.scrollTop();a.$popup.css({top:d,
left:b.fixedHPos});a.$popup.stop().fadeTo(a.options.speed,1);a.onCompleteCallback(true)},calcPosition:function(){var a=e.width(),b=e.height(),d=this.options.position[1],i=this.options.position[0];if(this.options.position[1]==="auto")d=Math.max(0,(b-this.$popup.outerHeight(true))/2);if(this.options.position[0]==="auto")i=(a-this.$popup.outerWidth(true))/2;return{fixedVPos:d,fixedHPos:i}},bind:function(){var a=this;a.options.maskClose&&c("."+a.ID_NAME).bind("click",function(){a.close()});a.options.escClose&&
g.bind("keydown."+a.ID_NUMBER,function(b){b.which===27&&a.close()});e.bind("resize."+a.ID_NUMBER,function(){a.reposition()});this.$popup.off("close").on("close",function(){a.close()})},unbind:function(){var a=e.data("popup")-1;c("."+this.ID_NAME).unbind("click");g.unbind("keydown."+this.ID_NUMBER);e.data("popup",a>0?a:null)},close:function(){var a=this;a.options.mask&&c("."+a.ID_NAME).fadeTo(a.options.speed,0,function(){c(this).remove()});a.unbind();a.$popup.data("id",null).stop().fadeTo(a.options.speed,
0,function(){c(this).hide();a.onCompleteCallback()});return false},onCompleteCallback:function(a){a?this.triggerCall(this.callback):this.triggerCall(this.options.onCloseCallback)},reposition:function(){var a=this,b;a.T_RESIZE=setTimeout(function(){b=a.calcPosition();a.$popup.dequeue().each(function(){c(this).css({left:b.fixedHPos,top:b.fixedVPos})})},50)},triggerCall:function(a,b){c.isFunction(a)&&a.call(this.$popup,b)}};c.fn.popup=function(a,b){return this.each(function(){c(this).data("id")||new f(c(this),
a,b)})};return f});
